# Windows 7 x86 Enterprise - Malware Analysis Sandbox
Why use certutil? Because I can.

## Tools required
- Command Prompt (CMD)
- PowerShell (PS)
- https://github.com/0x4F776C/Setup/blob/main/Chocolatey/malware-analysis.ps1

## Steps (Follow the same order)

Install Service Pack 1
```console
<CMD>
certutil.exe -urlcache -f http://download.windowsupdate.com/msdownload/update/software/crup/2011/05/windows6.1-kb2533552-x86_f2061d1c40b34f88efbe55adf6803d278aa67064.msu windows6.1-kb2533552-x86_f2061d1c40b34f88efbe55adf6803d278aa67064.msu

<CMD>
windows6.1-kb976932-x86_c3516bc5c9e69fee6d9ac4f981f5b95977a8a2fa.exe
```

Install KB3020369
```console
<CMD>
certutil.exe -urlcache -f https://www.microsoft.com/en-us/download/confirmation.aspx?id=46827 Windows6.1-KB3020369-x86.msu

<CMD>
Windows6.1-KB3020369-x86.msu
```

Install Windows 7 SP1 update
```console
<CMD>
certutil.exe -urlcache -f http://download.windowsupdate.com/d/msdownload/update/software/updt/2016/05/windows6.1-kb3125574-v4-x86_ba1ff5537312561795cc04db0b02fbb0a74b2cbd.msu windows6.1-kb3125574-v4-x86_ba1ff5537312561795cc04db0b02fbb0a74b2cbd.msu

<CMD>
windows6.1-kb3125574-v4-x86_ba1ff5537312561795cc04db0b02fbb0a74b2cbd.msu
```

Install .NET 3 Framework
```console
<CMD>
certutil -urlcache -f https://www.microsoft.com/en-us/download/confirmation.aspx?id=3005 dotnetfx30SP1setup.exe

<CMD>
dotnetfx30SP1setup.exe
```

Install .NET 4 Framework
```console
<CMD>
certutil.exe -urlcache -f https://www.microsoft.com/en-us/download/confirmation.aspx?id=17851 dotNetFx40_Full_setup.exe

<CMD>
dotNetFx40_Full_setup.exe
```

Run Windows updates
```console
<CMD>
wuauclt /detectnow /updatenow
```

Install KB4490628
```console
<CMD>
certutil.exe -urlcache -f http://download.windowsupdate.com/c/msdownload/update/software/secu/2019/03/windows6.1-kb4490628-x86_3cdb3df55b9cd7ef7fcb24fc4e237ea287ad0992.msu windows6.1-kb4490628-x86_3cdb3df55b9cd7ef7fcb24fc4e237ea287ad0992.msu

<CMD>
windows6.1-kb4490628-x86_3cdb3df55b9cd7ef7fcb24fc4e237ea287ad0992.msu
```

Run Windows updates
```console
<CMD>
wuauclt /detectnow /updatenow
```

Install Windows Management Framework 3
```console
<CMD>
certutil.exe -urlcache -f https://www.microsoft.com/en-us/download/confirmation.aspx?id=34595 Windows6.1-KB2506143-x86.msu

Windows6.1-KB2506143-x86.msu
```

Reboot and check PowerShell version
```console
<PS>
shutdown -r -t 0

<PS>
$PSVersionTable
```

Run chocolatey script for tools/dependencies installation
```console
<PS>
Set-ExecutionPolicy Bypass

<PS>
./malware-analysis.ps1
```

### References
[Install PSv3 on Windows 7](https://devblogs.microsoft.com/scripting/weekend-scripter-install-powershell-3-0-on-windows-7/)
<br />
[Error Code: 80072efe](https://superuser.com/questions/1631204/windows-7-windows-update-error-80072efe)
<br />
[Error Code: 80072ee2](https://appuals.com/windows-update-error-80072ee2/)
